<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="K2S73UudyU-JTh9S0U_KnOKgOvE7aW7EpO560okLyUU">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;blog.frosthe.net&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Mist&quot;,&quot;version&quot;:&quot;8.5.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;always&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12,&quot;width&quot;:300},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script><script src="/js/config.js"></script>
<meta name="description" content="本文介绍了 Repository 模式及其应用场景，以及在 .NET 中是如何实现 Repository 模式的">
<meta property="og:type" content="article">
<meta property="og:title" content="Repository 模式和工作单元">
<meta property="og:url" content="https://blog.frosthe.net/architecture-repository-pattern/index.html">
<meta property="og:site_name" content="FrostHe.Handbook">
<meta property="og:description" content="本文介绍了 Repository 模式及其应用场景，以及在 .NET 中是如何实现 Repository 模式的">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-03-18T11:53:19.000Z">
<meta property="article:modified_time" content="2018-11-24T12:55:01.023Z">
<meta property="article:author" content="Frost He">
<meta property="article:tag" content="architecture">
<meta property="article:tag" content="dotnet">
<meta property="article:tag" content="repository-pattern">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.frosthe.net/architecture-repository-pattern/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;blog.frosthe.net&#x2F;architecture-repository-pattern&#x2F;&quot;,&quot;path&quot;:&quot;architecture-repository-pattern&#x2F;&quot;,&quot;title&quot;:&quot;Repository 模式和工作单元&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>Repository 模式和工作单元 | FrostHe.Handbook</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{&quot;tracking_id&quot;:&quot;UA-125853342-1&quot;,&quot;only_pageview&quot;:true}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>
  <div class="site-meta">
      <a
        href="/" class="brand" rel="start">
        
        <h1 class="site-title">FrostHe.Handbook</h1>
          <p class="site-subtitle">Talk less, do more</p>
        
      </a>
      </div>
      <div class="site-nav-right">
        <div class="toggle popup-trigger">
        </div>
      </div>
    </div>


<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-film fa-fw"></i>时间线</a></li>
        <li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar sidebar-active">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Frost He" src="/images/avatar.jpg">
    <p class="site-author-name" itemprop="name">Frost He</p>
    <p>Full-stack web developer<p>
        <div class="site-description" itemprop="description">
          <i class="fa fa-fw fa-map-marker-alt"></i>
          <span>Chengdu, China</span>
        </div>
      </div>
                <div class="links-of-author site-overview-item animated">
                    <span class="links-of-author-item">
                      <a href="https://github.com/BerdyPango" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;BerdyPango" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
                    </span>
                    <span class="links-of-author-item">
                      <a href="https://plus.google.com/yourname" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i></a>
                    </span>
                    <span class="links-of-author-item">
                      <a href="https://www.linkedin.com/in/frosthe0419/" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;frosthe0419&#x2F;" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
                    </span>
                    <span class="links-of-author-item">
                      <a href="https://www.instagram.com/frosthe_pro/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;frosthe_pro&#x2F;" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
                    </span>
                    <span class="links-of-author-item">
                      <a href="https://steamcommunity.com/profiles/76561198049061021/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198049061021&#x2F;" rel="noopener" target="_blank"><i class="fab fa-steam-square fa-fw"></i></a>
                    </span>
                </div>
              
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.frosthe.net/architecture-repository-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Frost He">
      <meta itemprop="description" content="Chengdu, China">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FrostHe.Handbook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Repository 模式和工作单元
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-03-18 19:53:19" itemprop="dateCreated datePublished" datetime="2017-03-18T19:53:19+08:00">2017-03-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-11-24 20:55:01" itemprop="dateModified" datetime="2018-11-24T20:55:01+08:00">2018-11-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Architecture-and-Pattern/" itemprop="url" rel="index"><span itemprop="name">Architecture and Pattern</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
</div>

            <div class="post-description">本文介绍了 Repository 模式及其应用场景，以及在 .NET 中是如何实现 Repository 模式的</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>参考资料:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://martinfowler.com/eaaCatalog/repository.html">Repository Pattern</a></li>
<li><a target="_blank" rel="noopener" href="https://martinfowler.com/eaaCatalog/unitOfWork.html">UnitOfWork</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design">Design the infrastructure persistence layer</a></li>
</ul>
<h2 id="Repository-模式"><a href="#Repository-模式" class="headerlink" title="Repository 模式"></a>Repository 模式</h2><p><code>Repository</code> 是引入域模型与数据源提供器之间的对象，它们封装了访问数据源的功能，抽象出通用的数据访问方法，提供了更好的可维护性并将域模型与具体的数据访问组件进行解耦。</p>
<p>在「企业应用架构模式」一书中，<strong>Martin Fowler</strong> 这样描述一个 Repository:</p>
<blockquote>
<p><em>A repository performs the tasks of an intermediary between the domain model layers and data mapping, acting in a similar way to a set of domain objects in memory. Client objects declaratively build queries and send them to the repositories for answers. Conceptually, a repository encapsulates a set of objects stored in the database and operations that can be performed on them, providing a way that is closer to the persistence layer. Repositories, also, support the purpose of separating, clearly and in one direction, the dependency between the work domain and the data allocation or mapping.</em></p>
</blockquote>
<h2 id="Repository-模式让数据提供层便于测试"><a href="#Repository-模式让数据提供层便于测试" class="headerlink" title="Repository 模式让数据提供层便于测试"></a>Repository 模式让数据提供层便于测试</h2><p><code>Repository</code> 模式使得编写单元测试代码变得更加简单，当 <code>Repository</code> 模式的接口位于独立于具体实现的工程，便可采用模拟数据源的方式编写「假的」<code>Repository</code> 实现，让所有依赖 <code>Repository</code> 的类型的测试不再依赖具体的数据源实现，而将测试的重点放到域模型的核心逻辑上。</p>
<h2 id="工作单元"><a href="#工作单元" class="headerlink" title="工作单元"></a>工作单元</h2><p>当将数据读取或写入数据库时，跟踪修改记录是很重要的一环，否则将无法回滚数据。在实践中，可以一旦对象状态发生变化，就修改数据库中对应的数据，这种方式将导致非常多的小的数据库访问，速度将非常慢；也可以在对象交互期间开启事务，但这会引起并发任务时的数据不同步问题。「工作单元」跟踪对对象所做的所有变更，并最后反映在数据库中。</p>
<h2 id="传统-DAL-层与-Repository-模式的区别"><a href="#传统-DAL-层与-Repository-模式的区别" class="headerlink" title="传统 DAL 层与 Repository 模式的区别"></a>传统 DAL 层与 Repository 模式的区别</h2><p>数据访问对象直接在存储引擎上执行数据访问逻辑，而Repository首先在内存中标记对象的状态变化，进而在恰当的时机提交事务。<code>Repository</code> 采用「工作单元」来处理事务。这意味着一个具体的用户的行为(例如注册账号)造成的系统数据变化将在一个事务中处理。</p>
<p>使用 <code>Repository</code> 隐含着一种意图倾向，即域模型需要什么 Repository 便提供什么，一切都以域的需求为核心。而 DAL 则是作为组件存在，它不关心业务规则。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/architecture/" rel="tag"><i class="fa fa-tag"></i> architecture</a>
              <a href="/tags/dotnet/" rel="tag"><i class="fa fa-tag"></i> dotnet</a>
              <a href="/tags/repository-pattern/" rel="tag"><i class="fa fa-tag"></i> repository-pattern</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ddd-tactical-domain-service/" rel="prev" title="《实现领域驱动设计》读书笔记(6) - 战术建模之领域服务">
                  <i class="fa fa-chevron-left"></i> 《实现领域驱动设计》读书笔记(6) - 战术建模之领域服务
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/architecture-cqrs/" rel="next" title="CRQS - 命令与查询职责分离">
                  CRQS - 命令与查询职责分离 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Frost He</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">381k</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
